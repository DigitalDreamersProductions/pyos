#!/usr/bin/env python3
import os
import sys
import subprocess
import urllib.request
import shutil

# URL cruda a tu script en GitHub (ajústala con tu repo real)
GITHUB_RAW_URL = "https://raw.githubusercontent.com/TU_USUARIO/TU_REPO/main/pyos.py"
LOCAL_PATH = os.path.abspath(__file__)

def update_from_github():
    print("[pyos] Descargando última versión desde GitHub...")
    try:
        with urllib.request.urlopen(GITHUB_RAW_URL) as response, open(LOCAL_PATH + ".new", "wb") as out_file:
            shutil.copyfileobj(response, out_file)
        os.replace(LOCAL_PATH + ".new", LOCAL_PATH)
        print("[pyos] Actualización completada. Reinicia el servicio con:")
        print("       systemctl restart pyos.service")
    except Exception as e:
        print(f"[pyos] Error al actualizar: {e}")

def main():
    while True:
        try:
            cmd = input("pyos> ").strip()
            if not cmd:
                continue

            if cmd == "exit":
                print("[pyos] Cerrando sesión...")
                break

            elif cmd == "update":
                update_from_github()

            else:
                # Ejecutar cualquier comando de Linux
                subprocess.run(cmd, shell=True)

        except KeyboardInterrupt:
            print()  # para no cortar feo con Ctrl+C
            continue
        except EOFError:
            break
        except Exception as e:
            print(f"[pyos] Error: {e}")

if __name__ == "__main__":
    main()
